# Transfer Learning with Feature Extractor (regression)
- [Feature extraction](https://en.wikipedia.org/wiki/Feature_extraction)
- [Transfer learning](https://en.wikipedia.org/wiki/Transfer_learning)
- [Teachable Machine](https://teachablemachine.withgoogle.com/)


---

- `index.html`

```html
<!DOCTYPE html>
<html>
  <head>
    <title>ml5.js 연습</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/p5@1/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1/lib/addons/p5.sound.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/IDMNYU/p5.js-speech@0.0.3/lib/p5.speech.js"></script>
  </head>

  <body>
    <h1>Feature Extractor (regression)</h1>
    <script src="sketch.js"></script>
  </body>
</html>
```

---

- `sketch.js` (4)

```javascript
// Feature Extractor for regression

let mobilenet;
let classifier;
let video;
let label;
let trainButton;
let slider;

function modelReady() {
    console.log('Model is ready!');
}

function videoReady() {
  console.log('Video is ready!');
}

function whileTraining(loss) {
  if (loss == null) {
    console.log('Training Complete');
    classifier.classify(gotResults);
  } else {
    console.log(loss);
  }
}

function gotResults(error, results) { 
    if (error) {
        console.log(error);
    } else {
        label = results[0].label;
        classifier.classify(gotResults);
    }
}



function setup() {
    createCanvas(640, 550);
    video = createCapture(VIDEO);
    video.hide();
    mobilenet = ml5.featureExtractor('MobileNet', modelReady);  // feature extraction
    classifier = mobilenet.regression(video, videoReady); // regression based on features

    slider = createSlider(0, 1, 0.5, 0.01);
    slider.input(function() {
      console.log(slider.value());
    });

    trainButton = createButton('train');
    trainButton.mousePressed(function() {
      classifier.train(whileTraining); // callback
    });
}

function draw() {
    background(0);
    image(video, 0, 0);
    fill(0, 255, 255);
    textSize(32);
    text(label, 10, height - 20);
}  
```


---

- `sketch.js` (5)

```javascript
// Feature Extractor for regression

let mobilenet;
let predictor;
let video;
let val = 0;
let trainButton;
let slider;
let addButton;

function modelReady() {
    console.log('Model is ready!');
}

function videoReady() {
  console.log('Video is ready!');
}

function whileTraining(loss) {
  if (loss == null) {
    console.log('Training Complete');
    predictor.predict(gotResults);
  } else {
    console.log(loss);
  }
}

function gotResults(error, results) { 
    if (error) {
        console.log(error);
    } else {
        val = results.value;
        console.log(val);
        predictor.predict(gotResults);
    }
}



function setup() {
    createCanvas(640, 550);
    video = createCapture(VIDEO);
    video.hide();
    mobilenet = ml5.featureExtractor('MobileNet', modelReady);  // feature extraction
    predictor = mobilenet.regression(video, videoReady); // regression based on features

    slider = createSlider(0, 1, 0.5, 0.01);  
    
    addButton = createButton('add example image');
    addButton.mousePressed(function() {
      predictor.addImage(slider.value());
    });


    trainButton = createButton('train');
    trainButton.mousePressed(function() {
      predictor.train(whileTraining); // callback
    });
}

function draw() {
    background(0);
    image(video, 0, 0);
    fill(0, 255, 255);
    textSize(32);
    text(val, 10, height - 20);
}  
```


---

- `sketch.js` (6)

```javascript
let mobilenet;
let predictor;
let video;
let val = 0;
let trainButton;
let slider;
let addButton;

function modelReady() {
    console.log('Model is ready!');
}

function videoReady() {
  console.log('Video is ready!');
}

function whileTraining(loss) {
  if (loss == null) {
    console.log('Training Complete');
    predictor.predict(gotResults);
  } else {
    console.log(loss);
  }
}

function gotResults(error, results) { 
    if (error) {
        console.log(error);
    } else {
        val = results.value;
        console.log(val);
        predictor.predict(gotResults);
    }
}



function setup() {
    createCanvas(640, 550);
    video = createCapture(VIDEO);
    video.hide();
    mobilenet = ml5.featureExtractor('MobileNet', modelReady);  // feature extraction
    predictor = mobilenet.regression(video, videoReady); // regression based on features

    slider = createSlider(0, 1, 0.5, 0.01);  
    
    addButton = createButton('add example image');
    addButton.mousePressed(function() {
      predictor.addImage(slider.value());
    });


    trainButton = createButton('train');
    trainButton.mousePressed(function() {
      predictor.train(whileTraining); // callback
    });
}

function draw() {
    background(0);
    image(video, 0, 0, 640, 480);
    rectMode(CENTER);
    fill(255, 0, 200);
    rect(val*width, height/2, 50, 50);

    fill(0, 255, 255);
    textSize(32);
    text(val, 10, height - 20);
}  
```


