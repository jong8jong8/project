# Image Segmentation with U-Net
- [U-Net](https://en.wikipedia.org/wiki/U-Net)
- [Face/Head Segmentation Dataset](https://store.mut1ny.com/product/face-head-segmentation-dataset-community-edition?v=38dd815e66db)

---

- `index.html` 

```html
<!DOCTYPE html>
<html>
  <head>
    <title>ml5.js 연습</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/p5@1/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1/lib/addons/p5.sound.min.js"></script>
    <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/IDMNYU/p5.js-speech@0.0.3/lib/p5.speech.js"></script>
  </head>

  <body>
    <h1>Image Segmentation with U-Net</h1>
    <script src="sketch.js"></script>
  </body>
</html>
```


---

- `sketch.js` (0)

```javascript
let video;
let uNet;
let segmentationImage;

function setup() {
  createCanvas(640, 480);
  video = createCapture(VIDEO, videoReady);
  // video.hide();
  uNet = ml5.uNet('face', modelReady);
  segmentationImage = createImage(width, height);
}

function videoReady() {
  console.log('Video is ready!');
  uNet.segment(video, gotResult);  // initial segmentation
}

function modelReady() {
  console.log('Model is ready!');
}

function gotResult(error, results) {
  if (error) {
    console.error(error);
  } else {
    // console.log(results);
    segmentationImage = results.backgroundMask;  // 128 x 128
    // segmentationImage = results.featureMask; 
    // segmentationImage = results.mask; 
    uNet.segment(video, gotResult);
  }
}

function draw() {
  background(0, 255, 0);
  image(segmentationImage, 0, 0, width, height);
}
```


---

- `sketch.js` (1)

```javascript
let video;
let uNet;
let segmentationImage;
let backgroundImage;

function setup() {
  backgroundImage = loadImage('cat.jpg');
  createCanvas(640, 480);
  video = createCapture(VIDEO, videoReady);
  // video.hide();
  uNet = ml5.uNet('face', modelReady);
  segmentationImage = createImage(width, height);
}

function videoReady() {
  console.log('Video is ready!');
  uNet.segment(video, gotResult);  // initial segmentation
}

function modelReady() {
  console.log('Model is ready!');
}

function gotResult(error, results) {
  if (error) {
    console.error(error);
  } else {
    console.log(results);
    segmentationImage = results.backgroundMask;  
    uNet.segment(video, gotResult);
  }
}

function draw() {
  background(backgroundImage);
  image(segmentationImage, 0, 0, width, height);
}
```


---

- `sketch.js` (2) - silhouette

```javascript
let video;
let uNet;
let segmentationImage;
let backgroundImage;

function setup() {
  backgroundImage = loadImage('cat.jpg');
  createCanvas(640, 480);
  video = createCapture(VIDEO, videoReady);
  // video.hide();
  uNet = ml5.uNet('face', modelReady);
  segmentationImage = createImage(width, height);
}

function videoReady() {
  console.log('Video is ready!');
  uNet.segment(video, gotResult);  // initial segmentation
}

function modelReady() {
  console.log('Model is ready!');
}

function gotResult(error, results) {
  if (error) {
    console.error(error);
  } else {
    // console.log(results);
    segmentationImage = results.backgroundMask;
    uNet.segment(video, gotResult);
  }
}

function draw() {
  background(0, 0, 255);
  
  segmentationImage.loadPixels();
  for (let i = 0; i < segmentationImage.pixels.length; i += 4) {
    let r = segmentationImage.pixels[i + 0];
    let g = segmentationImage.pixels[i + 1];
    let b = segmentationImage.pixels[i + 2];
    if (r == 0 && g == 0 && b == 0) {
      segmentationImage.pixels[i + 3] = 0; // alpha
    } else {
      segmentationImage.pixels[i + 0] = 255;
      segmentationImage.pixels[i + 1] = 0;
      segmentationImage.pixels[i + 2] = 255;
    }
  }
  segmentationImage.updatePixels();
  
  image(segmentationImage, 0, 0, width, height);
}
```
